(function(a){var b={tokenList:"token-input-list",token:"list-mix-item",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"control-autocomplete-dropdown",dropdownItem:"control-autocomplete-suggestion",dropdownItem2:"control-autocomplete-suggestion",selectedDropdownItem:"control-autocomplete-suggestion-selected",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled",hint:"control-autocomplete-hint",suggestions:"control-autocomplete-suggestions",suggestion:"control-autocomplete-suggestion",thumbnail:"control-autocomplete-thumbnail",name:"control-autocomplete-name",mail:"control-autocomplete-mail",id:"control-autocomplete-id",listMix:"list-mix",listMixItem:"list-mix-item",listMixInner:"list-mix-inner",close:"control-autocomplete-close",closeIcon:"icon-close-gray_16_18 show",addedInfo:"control-autocomplete-added-info"},c={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:!1,hintText:"Digite o nome e sobrenome ou e-mail",noResultsText:"Sem resultados",searchingText:"Buscando...",crossDomain:!1,deleteText:"&times;",animateDropdown:!0,theme:null,zindex:999,resultsLimit:null,resultsFormatter:function(a,c,d,e){var f="",g="";return typeof e!="undefined"&&(f='<img class="'+b.thumbnail+'" src="'+e+'" alt="'+c+'" title="'+c+'">'),typeof d!="undefined"&&(g='<span class="'+b.mail+'">'+d+"</span>"),'<li class="'+b.suggestion+'">'+f+'<span class="'+b.name+'">'+c+"</span>"+g+'<span class="'+b.id+'">'+a+"</span></li>"},tokenFormatter:function(a,c,d,e){var f="",g="";return typeof e!="undefined"&&(f='<img class="'+b.thumbnail+'" src="'+e+'" alt="'+c+'" title="'+c+'">'),typeof d!="undefined"&&(g='<span class="'+b.mail+'">'+d+"</span>"),'<li><div class="'+b.listMixInner+'"><span class="'+b.close+'"><span class="'+b.closeIcon+'"></span></span>'+f+'<div class="'+b.addedInfo+'"><span class="'+b.name+'">'+c+"</span>"+g+'<span class="'+b.id+'">'+a+"</span></div></div></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",onResult:null,onAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1,triggerInviteByMail:"inviteByMail.reduAutocomplete"},d={BEFORE:0,AFTER:1,END:2},e={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188},f={init:function(b,d){var e=a.extend({},c,d||{});return this.each(function(){a(this).data("tokenInputObject",new a.TokenList(this,b,e))})},clear:function(){return this.data("tokenInputObject").clear(),this},add:function(a){return this.data("tokenInputObject").add(a),this},remove:function(a){return this.data("tokenInputObject").remove(a),this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(a){return this.data("tokenInputObject").toggleDisabled(a),this}};a.fn.tokenInput=function(a){return f[a]?f[a].apply(this,Array.prototype.slice.call(arguments,1)):f.init.apply(this,arguments)},a.TokenList=function(c,f,g){function x(b){typeof b=="boolean"?g.disabled=b:g.disabled=!g.disabled,n.prop("disabled",g.disabled),s.toggleClass(g.classes.disabled,g.disabled),p&&E(a(p),d.END),o.prop("disabled",g.disabled)}function y(){if(g.tokenLimit!==null&&j>=g.tokenLimit){n.hide(),I();return}}function z(){if(m===(m=n.val()))return;var a=m.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");input_resizer.html(a),n.width(input_resizer.width()+30)}function A(a){return a>=48&&a<=90||a>=96&&a<=111||a>=186&&a<=192||a>=219&&a<=222}function B(b){var c=!1;u.find("."+g.classes.listMixItem).each(function(){var d=a(this).find("."+g.classes.id).text();if(b.id==d){c=!0;return}});if(!c){var d=a(g.tokenFormatter(b.id,b.name,b.mail,b.avatar_32)),e=b.readonly===!0?!0:!1;e&&d.addClass(g.classes.tokenReadOnly),d.addClass(g.classes.token).appendTo(u),e||d.find("."+g.classes.close).on("click",function(){if(!g.disabled)return G(a(this).parent()),o.change(),!1});var f=b;return a.data(d.get(0),"tokeninput",b),i=i.slice(0,q).concat([f]).concat(i.slice(q)),q++,H(i,o),j+=1,g.tokenLimit!==null&&j>=g.tokenLimit&&(n.hide(),I()),d}}function C(b){var c=g.onAdd;if(j>0&&g.preventDuplicates){var d=null;s.children().each(function(){var c=a(this),e=a.data(c.get(0),"tokeninput");if(e&&e.id===b.id)return d=c,!1});if(d){D(d),t.insertAfter(d),W(n);return}}if(g.tokenLimit==null||j<g.tokenLimit)B(b),y();n.val(""),I(),a.isFunction(c)&&c.call(o,b)}function D(a){g.disabled||(a.addClass(g.classes.selectedToken),p=a.get(0),n.val(""),I())}function E(a,b){a.removeClass(g.classes.selectedToken),p=null,b===d.BEFORE?(t.insertBefore(a),q--):b===d.AFTER?(t.insertAfter(a),q++):(t.appendTo(s),q=j),W(n)}function F(b){var c=p;p&&E(a(p),d.END),c===b.get(0)?E(b,d.END):D(b)}function G(b){var c=a.data(b.get(0),"tokeninput"),d=g.onDelete,e=b.prevAll().length;e>q&&e--,b.remove(),p=null,W(n),i=i.slice(0,e).concat(i.slice(e+1)),e<q&&q--,H(i,o),j-=1,g.tokenLimit!==null&&(n.show().val(""),W(n)),a.isFunction(d)&&d.call(o,c)}function H(b,c){var d=a.map(b,function(a){return typeof g.tokenValue=="function"?g.tokenValue.call(this,a):a[g.tokenValue]});c.val(d.join(g.tokenDelimiter))}function I(){v.hide().empty(),r=null}function J(){v.show()}function K(){g.searchingText&&(v.html(a(document.createElement("span")).addClass(g.classes.hint).append(g.searchingText)),J())}function L(){g.hintText&&(v.html(a(document.createElement("span")).addClass(g.classes.hint).append(g.hintText)),J())}function N(a){return a.replace(M,"\\$&")}function O(a,b){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+N(b)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")}function P(a,b,c){return a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+N(b)+")(?![^<>]*>)(?![^&;]+;)","g"),O(b,c))}function Q(b,d){if(d&&d.length){v.empty();var e=a(document.createElement("ul")).addClass(g.classes.suggestions).appendTo(v).mouseover(function(b){R(a(b.target).closest("li"))}).mousedown(function(b){return C(a(b.target).closest("li").data("tokeninput")),o.change(),!1}).hide();g.resultsLimit&&d.length>g.resultsLimit&&(d=d.slice(0,g.resultsLimit)),a.each(d,function(c,d){var f=g.resultsFormatter(this.id,this.name,this.mail,this.avatar_32);f=P(f,d[g.propertyToSearch],b),f=a(f).appendTo(e),c%2?f.addClass(g.classes.dropdownItem):f.addClass(g.classes.dropdownItem2),c===0&&R(f),a.data(f.get(0),"tokeninput",d)}),J(),g.animateDropdown?e.slideDown("fast"):e.show()}else g.noResultsText&&(v.html(a(document.createElement("span")).addClass(g.classes.hint).append(g.noResultsText)),a(c).trigger(g.triggerInviteByMail),J())}function R(b){b&&(r&&S(a(r)),b.addClass(g.classes.selectedDropdownItem),r=b.get(0))}function S(a){a.removeClass(g.classes.selectedDropdownItem),r=null}function T(){var b=n.val();b&&b.length&&(p&&E(a(p),d.AFTER),b.length>=g.minChars?(K(),clearTimeout(l),l=setTimeout(function(){U(b)},g.searchDelay)):I())}function U(b){var c=b+V(),d=k.get(c);if(d)Q(b,d);else if(g.url){var e=V(),f={};f.data={};if(e.indexOf("?")>-1){var h=e.split("?");f.url=h[0];var i=h[1].split("&");a.each(i,function(a,b){var c=b.split("=");f.data[c[0]]=c[1]})}else f.url=e;f.data[g.queryParam]=b,f.type=g.method,f.dataType=g.contentType,g.crossDomain&&(f.dataType="jsonp"),f.success=function(d){a.isFunction(g.onResult)&&(d=g.onResult.call(o,d)),k.add(c,g.jsonContainer?d[g.jsonContainer]:d),n.val()===b&&Q(b,g.jsonContainer?d[g.jsonContainer]:d)},a.ajax(f)}else if(g.local_data){var j=a.grep(g.local_data,function(a){return a[g.propertyToSearch].toLowerCase().indexOf(b.toLowerCase())>-1});a.isFunction(g.onResult)&&(j=g.onResult.call(o,j)),k.add(c,j),Q(b,j)}}function V(){var a=g.url;return typeof g.url=="function"&&(a=g.url.call(g)),a}function W(a){setTimeout(function(){a.focus()},50)}if(a.type(f)==="string"||a.type(f)==="function"){g.url=f;var h=V();g.crossDomain===undefined&&typeof h=="string"&&(h.indexOf("://")===-1?g.crossDomain=!1:g.crossDomain=location.href.split(/\/+/g)[1]!==h.split(/\/+/g)[1])}else typeof f=="object"&&(g.local_data=f);g.classes?g.classes=a.extend({},b,g.classes):g.theme?(g.classes={},a.each(b,function(a,b){g.classes[a]=b+"-"+g.theme})):g.classes=b;var i=[],j=0,k=new a.TokenList.Cache,l,m,n=a('<input type="text"  autocomplete="off">').css({outline:"none"}).attr("id",g.idPrefix+c.id).focus(function(){if(g.disabled)return!1;(g.tokenLimit===null||g.tokenLimit!==j)&&L(),s.addClass(g.classes.focused)}).blur(function(){setTimeout(function(){I()},100),a(this).val(""),s.removeClass(g.classes.focused)}).keydown(function(b){var c,f;switch(b.keyCode){case e.UP:case e.DOWN:if(!a(this).val())c=t.prev(),f=t.next(),c.length&&c.get(0)===p||f.length&&f.get(0)===p?b.keyCode===e.UP?E(a(p),d.BEFORE):E(a(p),d.AFTER):b.keyCode===e.UP&&c.length?D(a(c.get(0))):b.keyCode===e.DOWN&&f.length&&D(a(f.get(0)));else{var g=null;b.keyCode===e.DOWN?g=a(r).next():g=a(r).prev(),g.length&&R(g)}return!1;case e.BACKSPACE:c=t.prev();if(!a(this).val().length)return p?(G(a(p)),o.change()):c.length&&D(a(c.get(0))),!1;a(this).val().length===1?I():setTimeout(function(){T()},5);break;case e.TAB:case e.ENTER:case e.NUMPAD_ENTER:case e.COMMA:if(r)return C(a(r).data("tokeninput")),o.change(),!1;break;case e.ESCAPE:return I(),!0;default:String.fromCharCode(b.which)&&setTimeout(function(){T()},5)}}),o=a(c).hide().val("").focus(function(){W(n)}).blur(function(){n.blur()}),p=null,q=0,r=null,s=a("<ul />").addClass(g.classes.tokenList).click(function(b){var c=a(b.target).closest("li");c&&c.get(0)&&a.data(c.get(0),"tokeninput")?F(c):(p&&E(a(p),d.END),W(n))}).mouseover(function(b){var c=a(b.target).closest("li");c&&p!==this&&c.addClass(g.classes.highlightedToken)}).mouseout(function(b){var c=a(b.target).closest("li");c&&p!==this&&c.removeClass(g.classes.highlightedToken)}).insertBefore(o),t=a("<li />").addClass(g.classes.inputToken).appendTo(s).append(n),u=a(document.createElement("ul")).addClass(g.classes.listMix);u.insertAfter(s);var v=a(document.createElement("div")).addClass(g.classes.dropdown).insertAfter(s).hide();o.val("");var w=g.prePopulate||o.data("pre");g.processPrePopulate&&a.isFunction(g.onResult)&&(w=g.onResult.call(o,w)),w&&w.length&&a.each(w,function(a,b){B(b),y()}),g.disabled&&x(!0),a.isFunction(g.onReady)&&g.onReady.call(),this.clear=function(){s.children("li").each(function(){a(this).children("input").length===0&&G(a(this))})},this.add=function(a){C(a)},this.remove=function(b){s.children("li").each(function(){if(a(this).children("input").length===0){var c=a(this).data("tokeninput"),d=!0;for(var e in b)if(b[e]!==c[e]){d=!1;break}d&&G(a(this))}})},this.getTokens=function(){return i},this.toggleDisabled=function(a){x(a)};var M=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g")},a.TokenList.Cache=function(b){var c=a.extend({max_size:500},b),d={},e=0,f=function(){d={},e=0};this.add=function(a,b){e>c.max_size&&f(),d[a]||(e+=1),d[a]=b},this.get=function(a){return d[a]}}})(jQuery);